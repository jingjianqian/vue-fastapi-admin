# we123 çˆ¬è™«è„šæœ¬ - çº¯å‡€ç‰ˆ

## ğŸ¯ æ ¸å¿ƒæ”¹è¿›

### æ—§ç‰ˆé—®é¢˜
- âŒ ä¾èµ–é¡¹ç›®çš„ Tortoise ORMã€æ•°æ®åº“è¿æ¥
- âŒ ä¾èµ– httpx åšé¢„æ£€
- âŒ ä¾èµ–é¡¹ç›®çš„ logger æ¨¡å—
- âŒ éœ€è¦å¼‚æ­¥è¿è¡Œï¼ˆasyncioï¼‰
- âŒ ä¸é¡¹ç›®è€¦åˆåº¦é«˜

### æ–°ç‰ˆä¼˜åŠ¿
- âœ… **ä»…ä¾èµ– DrissionPage**
- âœ… åŒæ­¥ä»£ç ï¼Œç®€å•æ˜“æ‡‚
- âœ… ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–é¡¹ç›®æ¨¡å—
- âœ… æ•°æ®ä¿å­˜ä¸º JSON Lines æ–‡ä»¶
- âœ… å®Œæ•´çš„æ–­ç‚¹ç»­çˆ¬
- âœ… å®æ—¶è¿›åº¦æ˜¾ç¤º

## ğŸ“ è„šæœ¬ç‰¹æ€§

### 1. é›¶ä¾èµ–ï¼ˆé™¤äº† DrissionPageï¼‰
```bash
pip install DrissionPage
```

### 2. æ•°æ®ä¿å­˜æ–¹å¼
- **æ•°æ®æ–‡ä»¶**ï¼š`app_runtime/we123_output/data.jsonl`
  - æ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡
  - æ˜“äºè§£æå’Œå¯¼å…¥
- **çŠ¶æ€æ–‡ä»¶**ï¼š`app_runtime/we123_output/state.json`
  - è®°å½•æ–­ç‚¹ä½ç½®
  - æ”¯æŒä¸­æ–­åç»§ç»­

### 3. å‚æ•°é…ç½®

```json
{
  "start_id": 1,
  "max_404_span": 500,
  "delay_sec": 3.0,
  "max_count": 0,
  "ua": "",
  "proxy": ""
}
```

**å‚æ•°è¯´æ˜ï¼š**
- `start_id`: èµ·å§‹IDï¼ˆé¦–æ¬¡è¿è¡Œæœ‰æ•ˆï¼Œåç»­è‡ªåŠ¨ä»æ–­ç‚¹ç»§ç»­ï¼‰
- `max_404_span`: è¿ç»­404å¤šå°‘æ¬¡ååœæ­¢
- `delay_sec`: æ¯æ¬¡è¯·æ±‚å»¶è¿Ÿç§’æ•°ï¼ˆ3-5ç§’æ¨èï¼‰
- `max_count`: æœ€å¤§é‡‡é›†æ•°é‡ï¼ˆ0=æ— é™ï¼Œå¦‚è®¾ç½®100åˆ™é‡‡é›†100æ¡ååœæ­¢ï¼‰
- `ua`: è‡ªå®šä¹‰User-Agentï¼ˆå¯é€‰ï¼‰
- `proxy`: ä»£ç†åœ°å€ï¼ˆå¯é€‰ï¼‰

## ğŸš€ ä½¿ç”¨æ–¹å¼

### 1. åœ¨è„šæœ¬å¹³å°è¿è¡Œ
1. æ‰¾åˆ°"we123å°ç¨‹åºé‡‡é›†å™¨"è„šæœ¬
2. ç¼–è¾‘å‚æ•°ï¼ˆå¯é€‰ï¼‰
3. ç‚¹å‡»"è¿è¡Œ"
4. æŸ¥çœ‹å®æ—¶æ—¥å¿—

### 2. è¾“å‡ºç¤ºä¾‹

```
[we123] å¯åŠ¨é‡‡é›†ä»»åŠ¡
  start_id: 1
  max_404_span: 500
  delay_sec: 3.0
  max_count: 100
  output: E:\code\my\vue-fastapi-admin\app_runtime\we123_output\data.jsonl

[we123] ä» ID 1 å¼€å§‹é‡‡é›†...

  [1] âœ… å¾®ä¿¡è¯»ä¹¦
  [2] âœ… è…¾è®¯æ–°é—»
  [3] 404 (è¿ç»­: 1/500)
  [4] âœ… ç¾å›¢å¤–å–
  ...
  [100] âœ… äº¬ä¸œè´­ç‰©

âœ… è¾¾åˆ°æœ€å¤§é‡‡é›†æ•°é‡: 100

==================================================
é‡‡é›†å®Œæˆç»Ÿè®¡ï¼š
  æˆåŠŸ: 100
  404: 15
  é”™è¯¯: 0
  æœ€åID: 115
  æ•°æ®æ–‡ä»¶: E:\code\my\vue-fastapi-admin\app_runtime\we123_output\data.jsonl
  çŠ¶æ€æ–‡ä»¶: E:\code\my\vue-fastapi-admin\app_runtime\we123_output\state.json
==================================================
```

### 3. æ–­ç‚¹ç»­çˆ¬

å¦‚æœä¸­é€”åœæ­¢ï¼Œå†æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä»ä¸Šæ¬¡çš„ä½ç½®ç»§ç»­ï¼š

```
[we123] ä» ID 116 å¼€å§‹é‡‡é›†...
```

## ğŸ“Š æ•°æ®æ ¼å¼

### data.jsonl æ–‡ä»¶æ ¼å¼

æ¯è¡Œä¸€ä¸ª JSON å¯¹è±¡ï¼š

```json
{"src_id": 1, "url": "https://www.we123.com/xcx/1/", "name": "å¾®ä¿¡è¯»ä¹¦", "category": "é˜…è¯»", "tags": ["è¯»ä¹¦", "å­¦ä¹ "], "desc": "æ­£ç‰ˆä¹¦ç±..."}
{"src_id": 2, "url": "https://www.we123.com/xcx/2/", "name": "è…¾è®¯æ–°é—»", "category": "æ–°é—»", "tags": ["èµ„è®¯", "æ–°é—»"], "desc": "è…¾è®¯æ–°é—»..."}
```

### å­—æ®µè¯´æ˜

| å­—æ®µ | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| src_id | int | æ¥æºID |
| url | string | è¯¦æƒ…é¡µURL |
| name | string | å°ç¨‹åºåç§° |
| category | string | åˆ†ç±» |
| tags | array | æ ‡ç­¾åˆ—è¡¨ |
| desc | string | æè¿° |
| icon_url | string | å›¾æ ‡URL |
| qrcode_url | string | å°ç¨‹åºç URL |
| screenshot_urls | array | æˆªå›¾URLåˆ—è¡¨ |
| developer | string | å¼€å‘è€… |
| crawl_time | string | é‡‡é›†æ—¶é—´ |

### state.json æ–‡ä»¶æ ¼å¼

```json
{
  "last_id": 115,
  "ok_count": 100,
  "not_found_count": 15,
  "error_count": 0
}
```

## ğŸ”„ æ•°æ®å¯¼å…¥

### å¯¼å…¥åˆ°æ•°æ®åº“

```python
import json

# è¯»å–æ•°æ®
with open('app_runtime/we123_output/data.jsonl', 'r', encoding='utf-8') as f:
    for line in f:
        data = json.loads(line)
        # æ’å…¥æ•°æ®åº“
        # INSERT INTO ...
```

### è½¬æ¢ä¸º CSV

```python
import json
import csv

# è¯»å–æ‰€æœ‰æ•°æ®
rows = []
with open('app_runtime/we123_output/data.jsonl', 'r', encoding='utf-8') as f:
    for line in f:
        rows.append(json.loads(line))

# å†™å…¥ CSV
with open('output.csv', 'w', encoding='utf-8-sig', newline='') as f:
    if rows:
        writer = csv.DictWriter(f, fieldnames=rows[0].keys())
        writer.writeheader()
        writer.writerows(rows)
```

### å¯¼å…¥åˆ° Excel

```python
import json
import pandas as pd

# è¯»å–æ•°æ®
rows = []
with open('app_runtime/we123_output/data.jsonl', 'r', encoding='utf-8') as f:
    for line in f:
        rows.append(json.loads(line))

# è½¬æ¢ä¸º DataFrame å¹¶ä¿å­˜
df = pd.DataFrame(rows)
df.to_excel('output.xlsx', index=False)
```

## ğŸ› ï¸ è‡ªå®šä¹‰ XPath

å¦‚æœç½‘ç«™ç»“æ„å˜åŒ–ï¼Œä¿®æ”¹è„šæœ¬ä¸­çš„ XPATHS å­—å…¸ï¼š

```python
XPATHS = {
    "name": "//h1[contains(@class,'xcx')]",
    "category": "//a[contains(@href,'/xcxcat/')]",
    "tags": "//div[contains(@class,'tags')]//a",
    "desc": "//div[contains(@class,'desc')]",
    # ... æ·»åŠ æˆ–ä¿®æ”¹ XPath
}
```

## ğŸ“Œ æ³¨æ„äº‹é¡¹

### 1. æµè§ˆå™¨é©±åŠ¨

DrissionPage éœ€è¦ Chrome/Chromium æµè§ˆå™¨ã€‚é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨ä¸‹è½½é©±åŠ¨ã€‚

### 2. çˆ¬å–é€Ÿåº¦

- å»ºè®®å»¶è¿Ÿ 3-5 ç§’ï¼ˆ`delay_sec`ï¼‰
- é¿å…é¢‘ç¹è¯·æ±‚è¢«å°IP
- å¯ä½¿ç”¨ä»£ç†æ± æé«˜ç¨³å®šæ€§

### 3. æ•°æ®å»é‡

è„šæœ¬æœ¬èº«ä¸åšå»é‡ï¼Œå¦‚éœ€å»é‡ï¼š
- åœ¨å¯¼å…¥æ•°æ®åº“æ—¶ä½¿ç”¨ UNIQUE çº¦æŸ
- æˆ–åœ¨æ•°æ®å¤„ç†é˜¶æ®µå»é‡

### 4. é”™è¯¯å¤„ç†

- å•ä¸ªé¡µé¢é”™è¯¯ä¸ä¼šä¸­æ–­æ•´ä¸ªä»»åŠ¡
- é”™è¯¯ä¼šè®°å½•åœ¨æ—¥å¿—å’Œç»Ÿè®¡ä¸­
- å¯æŸ¥çœ‹ stderr äº†è§£é”™è¯¯è¯¦æƒ…

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå…¨é‡é‡‡é›†
```json
{
  "start_id": 1,
  "max_404_span": 500,
  "delay_sec": 3.0,
  "max_count": 0
}
```
ä»å¤´é‡‡é›†ï¼Œé‡åˆ°è¿ç»­500ä¸ª404åœæ­¢ã€‚

### åœºæ™¯2ï¼šé‡‡é›†æŒ‡å®šæ•°é‡
```json
{
  "start_id": 1,
  "max_404_span": 500,
  "delay_sec": 3.0,
  "max_count": 1000
}
```
é‡‡é›†1000æ¡æ•°æ®ååœæ­¢ã€‚

### åœºæ™¯3ï¼šä»æŒ‡å®šIDå¼€å§‹
```json
{
  "start_id": 5000,
  "max_404_span": 500,
  "delay_sec": 3.0,
  "max_count": 0
}
```
ä» ID 5000 å¼€å§‹é‡‡é›†ã€‚

### åœºæ™¯4ï¼šä½¿ç”¨ä»£ç†
```json
{
  "start_id": 1,
  "max_404_span": 500,
  "delay_sec": 3.0,
  "max_count": 0,
  "proxy": "http://proxy.example.com:8080"
}
```

## ğŸ” ä¸æ—§ç‰ˆå¯¹æ¯”

### ä¾èµ–å¯¹æ¯”

| ä¾èµ– | æ—§ç‰ˆ | æ–°ç‰ˆ |
|------|------|------|
| DrissionPage | âœ… | âœ… |
| Tortoise ORM | âœ… | âŒ |
| httpx | âœ… | âŒ |
| asyncio | âœ… | âŒ |
| æ•°æ®åº“è¿æ¥ | âœ… | âŒ |
| é¡¹ç›®æ—¥å¿—æ¨¡å— | âœ… | âŒ |

### ä»£ç å¯¹æ¯”

| æŒ‡æ ‡ | æ—§ç‰ˆ | æ–°ç‰ˆ |
|------|------|------|
| ä»£ç è¡Œæ•° | ~380è¡Œ | ~225è¡Œ |
| ä¾èµ–æ¨¡å— | 6+ | 1 |
| å¤æ‚åº¦ | é«˜ï¼ˆå¼‚æ­¥ã€ORMï¼‰ | ä½ï¼ˆåŒæ­¥ã€æ–‡ä»¶ï¼‰ |
| ç‹¬ç«‹æ€§ | ä½ï¼ˆä¾èµ–é¡¹ç›®ï¼‰ | é«˜ï¼ˆå®Œå…¨ç‹¬ç«‹ï¼‰ |

### æ•°æ®è¾“å‡ºå¯¹æ¯”

| æ–¹å¼ | æ—§ç‰ˆ | æ–°ç‰ˆ |
|------|------|------|
| è¾“å‡ºç›®æ ‡ | MySQL æ•°æ®åº“ | JSON Lines æ–‡ä»¶ |
| çµæ´»æ€§ | ä½ï¼ˆéœ€é…ç½®æ•°æ®åº“ï¼‰ | é«˜ï¼ˆæ–‡ä»¶å¯ä»»æ„å¤„ç†ï¼‰ |
| æ˜“ç”¨æ€§ | ä¸­ï¼ˆéœ€å»ºè¡¨ï¼‰ | é«˜ï¼ˆç›´æ¥è¯»æ–‡ä»¶ï¼‰ |
| æ€§èƒ½ | ä¸­ï¼ˆç½‘ç»œIOï¼‰ | é«˜ï¼ˆæœ¬åœ°IOï¼‰ |

## ğŸ’¡ æœ€ä½³å®è·µ

1. **é¦–æ¬¡è¿è¡Œæµ‹è¯•**ï¼šè®¾ç½® `max_count: 10` æµ‹è¯•æ•ˆæœ
2. **è§‚å¯Ÿå»¶è¿Ÿ**ï¼šæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ `delay_sec`
3. **å®šæœŸå¤‡ä»½**ï¼šå®šæœŸå¤‡ä»½ `data.jsonl` å’Œ `state.json`
4. **æ‰¹é‡å¯¼å…¥**ï¼šé‡‡é›†å®Œæˆåç»Ÿä¸€å¯¼å…¥æ•°æ®åº“
5. **ç›‘æ§æ—¥å¿—**ï¼šé€šè¿‡ç•Œé¢å®æ—¶æŸ¥çœ‹é‡‡é›†è¿›åº¦

## ğŸ”— ç›¸å…³æ–‡ä»¶

- **è„šæœ¬æ¨¡æ¿**ï¼š`app/crawler/we123_script_template.py`
- **æ›´æ–°å·¥å…·**ï¼š`scripts/update_we123_script.py`
- **æ•°æ®è¾“å‡º**ï¼š`app_runtime/we123_output/`

---

**ç‰ˆæœ¬ï¼š** 2.0 çº¯å‡€ç‰ˆ
**æ›´æ–°æ—¶é—´ï¼š** 2025-11-13
**ç‰¹ç‚¹ï¼š** é›¶ä¾èµ–ã€é«˜æ€§èƒ½ã€æ˜“ç»´æŠ¤
